<!DOCTYPE html>
<html lang="en-nz">

<head>
    <title>What's my crab</title>
    <style>
    </style>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri&family=Permanent+Marker&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/whatcrab.css">
</head>

<body>
    <div class="container-fluid">
        <header class="row">
                <div class="col">
                    <h1>What's my crab?</h1>
                    <div class="header-tag-line">Helping to identify New Zealand crabs</div>
                </div>
        </header>
        <div class="details-popup-container"  style="display:none;" data-bind="visible: compareDialogVisible">
            <div class="details-popup">
                <div class="popup-banner">
                    Crab details
                    <div class="popup-close" data-bind="click : function() { toggleCompareDialogVisibility(); }">
                        <span class="material-icons">
                            cancel
                        </span>
                    </div>
                </div>
                <div class="popup-content" >
                    <!-- ko foreach: crabsForCompare -->
                        <div class="crab-detail-container">
                            <div data-bind="" class="remove-crab-from-dialog-container"><span data-bind="visible: $parent.crabsForCompare().length > 1, click: function() { toggleForCompare(); }">remove this crab</span></div>
                            <div class="common-name" data-bind="text:commonName"></div>
                            <div class="scientific-name" >(<span data-bind="text:scientificName"></span>)</div>
                            <div class="crab-no-image" title="I have no images of this crab" data-bind="visible: currentImage() === null">?</div>
                            <div class="crab-image-container" data-bind="with : currentImage" title="click for next image">
                                <div class="image-count-display" title="click image to show next picture" data-bind="text: $parent.images.length, visible: $parent.images.length > 1"></div>
                                <img class="crab-image" src="" data-bind="click : function() { $parent.showNextImage(); } , attr: { src : url }" alt="crab picture" />
                            </div> 
                            <div class="aka-list">
                                <div data-bind="visible: aka.length === 0" class="no-list-items">No aliases</div>
                                <div data-bind="visible: aka.length > 0">
                                    Also known as: 
                                    <ul>
                                    <!-- ko foreach: aka -->
                                        <li data-bind="text:$data"></li>
                                    <!-- /ko -->
                                    </ul>
                                </div>
                            </div>
                            <div class="details-list">
                                Details:
                                <ul>
                                <!-- ko foreach: details -->
                                    <li>
                                        <span data-bind="text: text"></span>
                                        <!-- ko if: $data["references"] -->
                                            <sup>
                                                <!-- ko foreach: references -->
                                                    <span data-bind="text:$data"></span>
                                                <!-- /ko -->
                                            </sup>
                                        <!-- /ko -->
                                    </li>
                                <!-- /ko -->
                                </ul>
                            </div>
                            <div class="similar-to-list">
                                Simlar crabs:
                                <ul>
                                <!-- ko foreach: similarTo -->
                                    <li><span data-bind="text: label"></span><span class="details-compare-link" data-bind="click: function() { $parents[1].openForCompareByKey(key) }">compare</span></li>
                                <!-- /ko -->
                                    <li data-bind="visible: similarTo.length === 0">none</li>
                                </ul>
                            </div>
                            <div class="references">
                                <!-- ko if: $data["references"] -->
                                    <!-- ko foreach: references -->
                                    <div class="reference"><span data-bind="text: id"></span>: <span data-bind="text: detail"></span></div>
                                    <!-- /ko -->
                                <!-- /ko -->
                            </div>
                            <div class="crab-links">
                                <div class="crab-link">
                                    <a data-bind="attr: { href : natureWatchLink }" target="_blank" title="See more info on inaturalist.nz">
                                        <i class="material-icons">info</i>
                                    </a>
                                </div>
                                <div class="crab-link">
                                    <a data-bind="attr: { href : natureWatchImagesLink }" target="_blank" title="See more images on inaturalist.nz">
                                        <i class="material-icons">image</i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    <!-- /ko -->
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                <div>
                    <div class="filters-info">
                        To identify your crab answer the below questions; that will filter the crabs shown in the list. 
                        As you answer a question other questions may appear. 
                        You can click the <span class="material-icons">zoom_in</span> to view more details of a crab, or select multiple crabs using <span class="material-icons">check_box_outline_blank</span> then use <span class="material-icons">zoom_in</span> to compare them.
                        <div class="expandor" data-bind="click: function() { filterInfoShown(!filterInfoShown()); } ">
                            <!-- <i class="material-icons">search</i> -->
                            &nbsp;
                            <div class="expander-icon">
                                More question info ...
                                <i data-bind="visible: !filterInfoShown()" class="material-icons">expand_more</i>
                                <i data-bind="visible: filterInfoShown()" class="material-icons">expand_less</i>
                            </div>
                        </div>
                        <div class="filters-info-details" data-bind="visible: filterInfoShown">
                            <ul>
                                <li>You can click the <span class="material-icons">help</span> icon for more help with each question.</li>
                                <li>You can select multiple answers for each question; for example if for the shape of the shell question you select both the round and square options then all round and square shaped crabs will show.</li>
                                <li>If you're unsure of the answer or a question doesn't apply you don't have to answer anything for it, or you can hide it.</li>
                            </ul>
                        </div>
                        
                    </div>
                    <div class="clear-all-filters-button" title="clear all answers and start from scratch" data-bind="visible: activeFilterCount() > 0, click : function() { clearAllFilters(); }">
                        Start over / clear all answers (<span data-bind="text: activeFilterCount"></span>)
                    </div>
                    <!-- ko foreach: filters -->
                        <div class="filter" data-bind="visible: visible, class : classes">
                            <div data-bind="visible : ignored, click : function() { ignored(false); }">
                                <span data-bind="text: question"></span> (ignored)
                            </div>
                            <div data-bind="visible : !ignored()">
                                <div class="question"><span data-bind="text: question"></span><i title="show more info" class="material-icons" data-bind="visible: !showHelpText(), click : function() { showHelpText(true); }">help</i></div>
                                
                                <div class="help-text" data-bind="visible: showHelpText" ><i title="hide more info" data-bind="click : function() { showHelpText(false); }" class="material-icons">help</i><span data-bind="html: helpText"></span></div>
                                <!-- <div>filter visibility is <span data-bind="text:visible"></span> </div> -->
                                <div class="filter-options">
                                    <!-- ko foreach: possibleValues -->
                                    <div class="filter-option" data-bind="css: { activated: activated }, click : function() { activated(!activated()); $parents[1].filterValueChangedEvent($parents[0]); }">
                                        
                                        <div data-bind="text:text"></div>
                                        <!-- <span data-bind="text:activated"></span> -->
                                        <div data-bind="visible: image">
                                            <img data-bind="attr: { src : image }" alt="filter option" />
                                        </div>
                                    </div>
                                    <!-- /ko -->
                                </div>
                                <div class="ignore-filter-container" data-bind="click : function() { $parents[0].filterIgnoreChangedEvent($data); }" title="I don't know / ignore this question">hide this question</div>
                            </div>
                        </div>
                    <!-- /ko -->
                </div>
            </div>
            <div class="col-md-8">
                <div class="matched-results-title">These are the crabs that match your answers (<span data-bind="text: shownCrabCount"></span>):</div>
                
                <!-- ko foreach: crabData -->
                <div class="crab-container crab-shadow" data-bind="visible:visible">
                    <div class="common-name" data-bind="text:commonName"></div>
                    <div class="scientific-name" >(<span data-bind="text:scientificName"></span>)</div>
                    <div class="crab-no-image" title="I have no images of this crab" data-bind="visible: currentImage() === null">?</div>
                    <div class="crab-image-container" data-bind="with : currentImage" title="click for next image">
                        <div class="image-count-display" title="click image to show next picture" data-bind="text: $parent.images.length, visible: $parent.images.length > 1"></div>
                        <img class="crab-image" src="" data-bind="click : function() { $parent.showNextImage(); } , attr: { src : $parent.currentImageUrlSmall }" alt="crab picture" />
                    </div> 
                    <div class="crab-links">
                        <div class="crab-link">
                            <a data-bind="attr: { href : natureWatchLink }" target="_blank" title="See more info on inaturalist.nz">
                                <i class="material-icons">info</i>
                            </a>
                        </div>
                        <div class="crab-link">
                            <a data-bind="attr: { href : natureWatchImagesLink }" target="_blank" title="See more images on inaturalist.nz">
                                <i class="material-icons">image</i>
                            </a>
                        </div>
                        <div class="crab-links-right">
                            <div class="crab-link" data-bind="click: function() { toggleForCompare(); }" title="select this crab for comparing when you open the crab details popup">
                                <span data-bind="visible: selectedForCompare" class="material-icons">check_box</span>
                                <span data-bind="visible: !selectedForCompare()" class="material-icons">check_box_outline_blank</span>
                            </div>
                            <div class="crab-link" data-bind="click: function() { selectForCompare(); $parent.toggleCompareDialogVisibility(); }" title="open the details of this and any other selected crab">
                                <span class="material-icons">zoom_in</span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /ko -->
            </div>
        </div>
        <footer class="row">
            <div class="col"><br/>
                Sources: 
                <ul>
                    <li>iNaturalist. Available from https://www.inaturalist.org. Accessed 28/04/2020.</li>
                    <li>Wikipedia. Available from https://en.wikipedia.org, Wikimedia Foundation. Accessed 28/04/2020.</li>
                    <li>Morton, J., Miller, M. (1973) The New Zealand Sea Shore (pp88-94). Collins, London 1973.</li>
                    <li>Wilkens, S. L., Ahyong, S. T (2015) Coastal Crabs a guide to the crabs of New Zealand Version 1, 2015, 10-49 NIWA https://niwa.co.nz/static/web/coastal_crabs_2015.pdf.</li>
                    <li>The icons on the questions are based on the awesome ones in the NIWA costal crab guide.</li>
                </ul>
            </div>
        </footer>
    </div>

    <script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.js"></script>
    <script type="text/javascript" src="js/knockout-3.5.1.js"></script>
    <script type="text/javascript" src="js/whatcrab-crabdata.js"></script>
    <script type="text/javascript" src="js/whatcrab-filterdata.js"></script>
    <script type="text/javascript" src="js/whatcrab.js"></script>
    <script type="text/javascript">



    </script>
</body>

</html>